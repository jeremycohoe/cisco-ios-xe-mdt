# Telegraf Configuration for Cisco IOS XE gNMI Telemetry - Advanced
# Author: Jeremy Cohoe
# Description: Advanced configuration with both OpenConfig and Cisco Native models
# Device: Cisco Catalyst 9300 running IOS XE 17.15.1
# Updated: November 2025
#
# This configuration demonstrates:
# - OpenConfig standard models (cross-vendor compatible)
# - Cisco Native YANG models (Cisco-specific operational data)
# - Separate output files per subscription for easier analysis
# - Multiple sample intervals for different data types

# Global Agent Configuration
[agent]
  interval = "10s"
  round_interval = true
  metric_batch_size = 1000
  metric_buffer_limit = 10000
  collection_jitter = "0s"
  flush_interval = "10s"
  flush_jitter = "0s"
  precision = "0s"
  hostname = ""
  omit_hostname = false

###############################################################################
# OUTPUT PLUGINS - Separate files per subscription
###############################################################################

# OpenConfig Interface Counters Output
[[outputs.file]]
  files = ["/tmp/oc_interface_counters.log"]
  data_format = "influx"
  namepass = ["oc_interface_counters"]

# OpenConfig Platform Output
[[outputs.file]]
  files = ["/tmp/oc_platform.log"]
  data_format = "influx"
  namepass = ["oc_platform"]

# OpenConfig System Output
[[outputs.file]]
  files = ["/tmp/oc_system.log"]
  data_format = "influx"
  namepass = ["oc_system"]

# CPU Usage Output (Cisco Native)
[[outputs.file]]
  files = ["/tmp/cpu_usage.log"]
  data_format = "influx"
  namepass = ["cpu_usage"]

# Memory Statistics Output (Cisco Native)
[[outputs.file]]
  files = ["/tmp/memory_stats.log"]
  data_format = "influx"
  namepass = ["memory_stats"]

# Environment Sensors Output (Cisco Native)
[[outputs.file]]
  files = ["/tmp/environment_sensors.log"]
  data_format = "influx"
  namepass = ["environment_sensors"]

# PoE Data Output (Cisco Native)
[[outputs.file]]
  files = ["/tmp/poe_data.log"]
  data_format = "influx"
  namepass = ["poe_data"]

# LLDP Neighbors Output (Cisco Native)
[[outputs.file]]
  files = ["/tmp/lldp_neighbors.log"]
  data_format = "influx"
  namepass = ["lldp_neighbors"]

# CDP Neighbors Output (Cisco Native)
[[outputs.file]]
  files = ["/tmp/cdp_neighbors.log"]
  data_format = "influx"
  namepass = ["cdp_neighbors"]

# ARP Data Output (Cisco Native)
[[outputs.file]]
  files = ["/tmp/arp_data.log"]
  data_format = "influx"
  namepass = ["arp_data"]

# Console output for real-time monitoring (all metrics)
[[outputs.file]]
  files = ["stdout"]
  data_format = "influx"

###############################################################################
# INPUT PLUGINS - OpenConfig Models (Standard, Cross-Vendor)
###############################################################################

# Combined OpenConfig Subscriptions
[[inputs.gnmi]]
  addresses = ["10.85.134.65:9339"]
  username = "admin"
  password = "password"
  redial = "10s"
  tls_enable = true
  insecure_skip_verify = true
  encoding = "json_ietf"

  ###############################################################################
  # OpenConfig Models
  ###############################################################################

  ## OpenConfig Interface Counters
  [[inputs.gnmi.subscription]]
    name = "oc_interface_counters"
    origin = "openconfig"
    path = "/interfaces/interface/state/counters"
    subscription_mode = "sample"
    sample_interval = "10s"

  ## OpenConfig Platform - Hardware components
  [[inputs.gnmi.subscription]]
    name = "oc_platform"
    origin = "openconfig"
    path = "/components"
    subscription_mode = "sample"
    sample_interval = "15s"

  ## OpenConfig System - System information
  [[inputs.gnmi.subscription]]
    name = "oc_system"
    origin = "openconfig"
    path = "/system"
    subscription_mode = "sample"
    sample_interval = "20s"

  ###############################################################################
  # Cisco Native Models - Using origin="legacy"
  ###############################################################################

  ## CPU Usage - Per-process CPU utilization
  [[inputs.gnmi.subscription]]
    name = "cpu_usage"
    origin = "legacy"
    path = "/process-cpu-ios-xe-oper:cpu-usage/cpu-utilization"
    subscription_mode = "sample"
    sample_interval = "10s"

  ## Memory Statistics - System memory usage
  [[inputs.gnmi.subscription]]
    name = "memory_stats"
    origin = "legacy"
    path = "/memory-ios-xe-oper:memory-statistics/memory-statistic"
    subscription_mode = "sample"
    sample_interval = "10s"

  ## Environment Sensors - Temperature, fans, power
  [[inputs.gnmi.subscription]]
    name = "environment_sensors"
    origin = "legacy"
    path = "/environment-ios-xe-oper:environment-sensors"
    subscription_mode = "sample"
    sample_interval = "15s"

  ## PoE Data - Power over Ethernet
  [[inputs.gnmi.subscription]]
    name = "poe_data"
    origin = "legacy"
    path = "/poe-ios-xe-oper:poe-oper-data/poe-switch"
    subscription_mode = "sample"
    sample_interval = "20s"

  ## LLDP Neighbors
  [[inputs.gnmi.subscription]]
    name = "lldp_neighbors"
    origin = "legacy"
    path = "/lldp-ios-xe-oper:lldp-entries"
    subscription_mode = "sample"
    sample_interval = "30s"

  ## CDP Neighbors
  [[inputs.gnmi.subscription]]
    name = "cdp_neighbors"
    origin = "legacy"
    path = "/cdp-ios-xe-oper:cdp-neighbor-details"
    subscription_mode = "sample"
    sample_interval = "30s"

  ## ARP Data - ARP table
  [[inputs.gnmi.subscription]]
    name = "arp_data"
    origin = "legacy"
    path = "/arp-ios-xe-oper:arp-data"
    subscription_mode = "sample"
    sample_interval = "20s"

  [inputs.gnmi.tags]
    source = "10.85.134.65"
    device_type = "c9300"
    site = "lab"
